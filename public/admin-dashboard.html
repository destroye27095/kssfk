<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - KSFP (Advanced)</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
            --secondary-dark: #495057;
        }

        * {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .sidebar {
            min-height: 100vh;
            background: linear-gradient(180deg, var(--dark-color) 0%, var(--secondary-dark) 100%);
            color: white;
            position: fixed;
            width: 280px;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
        }

        .sidebar-header h4 {
            margin: 0;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.75);
            padding: 12px 20px;
            margin: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--primary-color);
            transform: translateX(5px);
        }

        .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border-left-color: #fff;
            font-weight: 600;
        }

        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .main-content {
            margin-left: 280px;
            padding: 30px 20px;
            min-height: 100vh;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            background: white;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .metric-card.success {
            background: linear-gradient(135deg, var(--success-color), #1e7e34);
        }

        .metric-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #d39e00);
            color: #000;
        }

        .metric-card.danger {
            background: linear-gradient(135deg, var(--danger-color), #bd2130);
        }

        .metric-card.info {
            background: linear-gradient(135deg, var(--info-color), #0c5460);
        }

        .metric-card .card-body {
            position: relative;
            z-index: 1;
        }

        .metric-card h3 {
            font-size: 2.5em;
            font-weight: 700;
            margin: 10px 0;
        }

        .metric-card p {
            margin: 0;
            font-size: 0.95em;
            opacity: 0.9;
        }

        .btn-custom {
            border-radius: 8px;
            padding: 10px 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .table-responsive {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .table {
            margin-bottom: 0;
        }

        .table thead {
            background: linear-gradient(135deg, var(--dark-color), var(--secondary-dark));
        }

        .table tbody tr {
            transition: all 0.2s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(0,123,255,0.05);
        }

        .badge-custom {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .card-header {
            background: linear-gradient(135deg, rgba(0,123,255,0.05), rgba(40,167,69,0.05));
            border-bottom: 2px solid rgba(0,0,0,0.1);
            border-radius: 15px 15px 0 0 !important;
        }

        .card-header h5 {
            margin: 0;
            font-weight: 600;
            color: var(--dark-color);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.15);
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            margin: 15px 0;
        }

        .loading-spinner {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .alert-custom {
            border-radius: 10px;
            border: none;
            border-left: 4px solid;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .page-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0,0,0,0.1);
        }

        .page-header h2 {
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .page-header p {
            margin: 0;
            color: #6c757d;
            font-size: 0.95em;
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                min-height: auto;
            }
            .main-content {
                margin-left: 0;
                padding: 20px 10px;
            }
            .sidebar .nav {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .sidebar .nav-link {
                margin: 2px;
                padding: 8px 12px;
                font-size: 0.85em;
            }
            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        .footer-text {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.85em;
            border-top: 1px solid #e9ecef;
            margin-top: 40px;
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h4>
                <i class="fas fa-graduation-cap me-2"></i>
                KSFP Admin
            </h4>
            <small class="text-light">v2.0 Advanced Edition</small>
        </div>

        <ul class="nav flex-column mt-3">
            <li class="nav-item">
                <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('schools')">
                    <i class="fas fa-school"></i> Schools
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('fees')">
                    <i class="fas fa-money-bill-wave"></i> Fee Management
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('payments')">
                    <i class="fas fa-credit-card"></i> Payments
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('staff')">
                    <i class="fas fa-users"></i> Staff
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('performance')">
                    <i class="fas fa-chart-line"></i> Performance
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('reports')">
                    <i class="fas fa-file-alt"></i> Reports
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('compliance')">
                    <i class="fas fa-shield-alt"></i> Compliance
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </li>
        </ul>

        <div class="footer-text mt-5 pt-3">
            <small>&copy; 2026 KSFP<br>All Rights Reserved<br><strong>Wanoto Raphael</strong><br>Developer - Meru University IT</small>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active">
            <div class="page-header">
                <h2><i class="fas fa-tachometer-alt me-3"></i>Dashboard Overview</h2>
                <p>Welcome back! Here's your system status at a glance.</p>
                <button class="btn btn-primary btn-custom mt-3" onclick="refreshDashboard()">
                    <i class="fas fa-sync-alt me-2"></i>Refresh Data
                </button>
            </div>

            <!-- Metrics Cards -->
            <div class="stats-container">
                <div class="card metric-card">
                    <div class="card-body text-center">
                        <i class="fas fa-school fa-3x mb-3 opacity-75"></i>
                        <h3 id="total-schools">0</h3>
                        <p class="mb-0"><strong>Total Schools</strong></p>
                    </div>
                </div>
                <div class="card metric-card success">
                    <div class="card-body text-center">
                        <i class="fas fa-users fa-3x mb-3 opacity-75"></i>
                        <h3 id="total-staff">0</h3>
                        <p class="mb-0"><strong>Total Staff</strong></p>
                    </div>
                </div>
                <div class="card metric-card warning">
                    <div class="card-body text-center">
                        <i class="fas fa-money-bill fa-3x mb-3 opacity-75"></i>
                        <h3 id="total-revenue">KES 0</h3>
                        <p class="mb-0"><strong>Total Revenue</strong></p>
                    </div>
                </div>
                <div class="card metric-card info">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-3x mb-3 opacity-75"></i>
                        <h3 id="avg-performance">0%</h3>
                        <p class="mb-0"><strong>Avg Performance</strong></p>
                    </div>
                </div>
                <div class="card metric-card danger">
                    <div class="card-body text-center">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3 opacity-75"></i>
                        <h3 id="alerts-count">0</h3>
                        <p class="mb-0"><strong>Active Alerts</strong></p>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mt-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-pie me-2"></i>Schools Distribution</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="schoolsByTypeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-bar me-2"></i>Performance Trends</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-history me-2"></i>Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="loading-spinner" id="activity-loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div id="recent-activity" class="list-group list-group-flush">
                        <!-- Activity items will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Schools Section -->
        <div id="schools-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-school me-3"></i>School Management</h2>
                <p>Manage all registered schools in the system.</p>
            </div>

            <!-- Filters -->
            <div class="filter-section">
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="school-search" placeholder="Search schools...">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="school-type-filter">
                            <option value="">All Types</option>
                            <option value="primary">Primary</option>
                            <option value="secondary">Secondary</option>
                            <option value="university">University</option>
                        </select>
                    </div>
                    <div class="col-md-5">
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-custom" onclick="filterSchools()">
                                <i class="fas fa-filter me-1"></i>Filter
                            </button>
                            <button class="btn btn-success btn-custom" onclick="showAddSchoolModal()">
                                <i class="fas fa-plus me-1"></i>Add School
                            </button>
                            <button class="btn btn-outline-secondary btn-custom" onclick="clearFilters()">
                                <i class="fas fa-times me-1"></i>Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schools Table -->
            <div class="card">
                <div class="card-body">
                    <div class="loading-spinner" id="schools-loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="table-responsive" id="schools-table-container" style="display: none;">
                        <table class="table table-hover" id="schools-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>School Name</th>
                                    <th>Location</th>
                                    <th>Type</th>
                                    <th>Annual Fee</th>
                                    <th>Staff Count</th>
                                    <th>Performance</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="schools-table-body">
                                <!-- Table rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fee Management Section (NEW) -->
        <div id="fees-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-money-bill-wave me-3"></i>Fee Management</h2>
                <p>Configure and manage annual fee structures for schools.</p>
            </div>

            <!-- Fee Overview -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h3 id="free-schools-count">0</h3>
                            <p>Free Schools</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card success">
                        <div class="card-body text-center">
                            <h3 id="affordable-schools-count">0</h3>
                            <p>Affordable Range</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card warning">
                        <div class="card-body text-center">
                            <h3 id="moderate-schools-count">0</h3>
                            <p>Moderate Range</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card danger">
                        <div class="card-body text-center">
                            <h3 id="expensive-schools-count">0</h3>
                            <p>Premium Range</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fee Configuration -->
            <div class="filter-section">
                <h5 class="mb-3">Fee Structure by School Level</h5>
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">School Level</label>
                        <select class="form-select" id="fee-level-select">
                            <option value="primary">Primary School</option>
                            <option value="secondary">Secondary School</option>
                            <option value="university">University</option>
                            <option value="vocational">Vocational</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Min Annual Fee (KES)</label>
                        <input type="number" class="form-control" id="fee-min" placeholder="e.g. 24000">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Max Annual Fee (KES)</label>
                        <input type="number" class="form-control" id="fee-max" placeholder="e.g. 300000">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-primary w-100" onclick="updateFeeStructure()">
                            <i class="fas fa-save me-1"></i>Update
                        </button>
                    </div>
                </div>
            </div>

            <!-- Fee Table -->
            <div class="card">
                <div class="card-header">
                    <h5>Annual Fee Summary by School</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>School Name</th>
                                    <th>Type</th>
                                    <th>Annual Fee (KES)</th>
                                    <th>Affordability</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="fees-table-body">
                                <!-- Fee rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payments Section -->
        <div id="payments-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-credit-card me-3"></i>Payment Management</h2>
                <p>Track and manage school fee payments.</p>
            </div>

            <!-- Payment Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h3 id="pending-payments">0</h3>
                            <p>Pending</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card success">
                        <div class="card-body text-center">
                            <h3 id="completed-payments">0</h3>
                            <p>Completed</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card warning">
                        <div class="card-body text-center">
                            <h3 id="failed-payments">0</h3>
                            <p>Failed</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card info">
                        <div class="card-body text-center">
                            <h3 id="total-collected">KES 0</h3>
                            <p>Total Collected</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payments Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="payments-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>Payment ID</th>
                                    <th>School</th>
                                    <th>Amount (KES)</th>
                                    <th>Date</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="payments-table-body">
                                <!-- Payment rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff Section -->
        <div id="staff-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-users me-3"></i>Staff Management</h2>
                <p>Manage school staff and personnel.</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5>Staff Directory</h5>
                        <button class="btn btn-success btn-custom btn-sm" onclick="showAddStaffModal()">
                            <i class="fas fa-plus me-1"></i>Add Staff
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="loading-spinner" id="staff-loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="table-responsive" id="staff-table-container" style="display: none;">
                        <table class="table table-hover" id="staff-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>Name</th>
                                    <th>Position</th>
                                    <th>Department</th>
                                    <th>School</th>
                                    <th>Performance</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="staff-table-body">
                                <!-- Table rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Section -->
        <div id="performance-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-chart-line me-3"></i>Performance Analytics</h2>
                <p>Monitor school performance and generate insights.</p>
            </div>

            <!-- Performance Alerts -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Performance Alerts</h5>
                </div>
                <div class="card-body">
                    <div id="performance-alerts">
                        <!-- Alerts will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Performance Table -->
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between">
                        <h5>Performance Tracking</h5>
                        <button class="btn btn-primary btn-custom btn-sm" onclick="calculateAllPerformance()">
                            <i class="fas fa-calculator me-1"></i>Calculate All
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="performance-table">
                            <thead class="table-dark">
                                <tr>
                                    <th>School</th>
                                    <th>Period</th>
                                    <th>Overall Score</th>
                                    <th>Deviation</th>
                                    <th>Academic</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="performance-table-body">
                                <!-- Table rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-file-alt me-3"></i>Reports & Analytics</h2>
                <p>Generate and view comprehensive system reports.</p>
            </div>

            <div class="row">
                <div class="col-lg-7">
                    <div class="card">
                        <div class="card-header">
                            <h5>Generate Reports</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Report Type</label>
                                <select class="form-select" id="report-type">
                                    <option value="performance">Performance Report</option>
                                    <option value="fees">Fee Structure Report</option>
                                    <option value="payments">Payments Report</option>
                                    <option value="staff">Staff Report</option>
                                    <option value="schools">Schools Summary</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">School (optional)</label>
                                <select class="form-select" id="report-school">
                                    <option value="">All Schools</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date Range</label>
                                <div class="row g-2">
                                    <div class="col">
                                        <input type="date" class="form-control" id="report-from-date">
                                    </div>
                                    <div class="col">
                                        <input type="date" class="form-control" id="report-to-date">
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" onclick="generateReport()">
                                <i class="fas fa-download me-1"></i>Generate Report
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="card">
                        <div class="card-header">
                            <h5>Quick Stats</h5>
                        </div>
                        <div class="card-body">
                            <div id="quick-stats">
                                <!-- Stats will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Section (NEW) -->
        <div id="compliance-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-shield-alt me-3"></i>Compliance Management</h2>
                <p>Monitor school compliance and enforce penalties.</p>
            </div>

            <!-- Compliance Summary -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h3 id="compliant-schools">0</h3>
                            <p>Compliant Schools</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card metric-card warning">
                        <div class="card-body text-center">
                            <h3 id="at-risk-schools">0</h3>
                            <p>At Risk</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card metric-card danger">
                        <div class="card-body text-center">
                            <h3 id="non-compliant-schools">0</h3>
                            <p>Non-Compliant</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Penalties Table -->
            <div class="card">
                <div class="card-header">
                    <h5>Active Penalties & Disputes</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>School</th>
                                    <th>Violation</th>
                                    <th>Penalty Amount</th>
                                    <th>Status</th>
                                    <th>Applied Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="compliance-table-body">
                                <!-- Compliance rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="section">
            <div class="page-header">
                <h2><i class="fas fa-cog me-3"></i>System Settings</h2>
                <p>Configure system-wide settings and preferences.</p>
            </div>

            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>General Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">System Name</label>
                                <input type="text" class="form-control" value="Kenya School Fee Platform" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Support Email</label>
                                <input type="email" class="form-control" value="support@ksfp.ac.ke">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">System Version</label>
                                <input type="text" class="form-control" value="2.0.0" readonly>
                            </div>
                            <button class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Save Changes
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Payment Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Payment Gateway</label>
                                <select class="form-select">
                                    <option>Pesapal</option>
                                    <option>M-Pesa</option>
                                    <option>Bank Transfer</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Currency</label>
                                <input type="text" class="form-control" value="KES" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Default Transaction Fee (%)</label>
                                <input type="number" class="form-control" value="2.5" step="0.1">
                            </div>
                            <button class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-text">
            <small>&copy; 2026 Kenya School Fee Platform - All Rights Reserved | Developer: Wanoto Raphael, Meru University IT</small>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let currentSection = 'dashboard';
        let schoolsData = [];
        let staffData = [];
        let performanceData = [];
        let paymentsData = [];

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setupEventListeners();
        });

        // Show different sections with animation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');

            // Update sidebar active state
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('.nav-link').classList.add('active');

            currentSection = sectionName;

            // Load section-specific data
            switch(sectionName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'schools':
                    loadSchoolsData();
                    break;
                case 'fees':
                    loadFeesData();
                    break;
                case 'payments':
                    loadPaymentsData();
                    break;
                case 'staff':
                    loadStaffData();
                    break;
                case 'performance':
                    loadPerformanceData();
                    break;
                case 'compliance':
                    loadComplianceData();
                    break;
            }
        }

        // Load dashboard overview data
        async function loadDashboardData() {
            try {
                // Fetch from API or use mock data
                const response = await fetch('/api/admin/dashboard').catch(() => ({
                    success: true,
                    data: getMockDashboardData()
                }));
                const data = await response.json ? await response.json() : response;

                if (data.success || data.data) {
                    updateMetricsCards(data.data || data);
                    updateCharts(data.data || data);
                }
            } catch (error) {
                console.log('Using mock data for dashboard');
                const mockData = getMockDashboardData();
                updateMetricsCards(mockData);
                updateCharts(mockData);
            }
        }

        // Mock data generator
        function getMockDashboardData() {
            return {
                schools_summary: {
                    total_schools: 45,
                    avg_staff_per_school: 25
                },
                performance_stats: {
                    avg_overall_score: 78.5
                },
                alerts_count: 5,
                revenue: 4500000,
                recent_activity: [
                    { description: 'New school registered', school_name: 'Test School', timestamp: new Date() },
                    { description: 'Payment received', school_name: 'School A', timestamp: new Date() }
                ]
            };
        }

        // Update metrics cards
        function updateMetricsCards(data) {
            document.getElementById('total-schools').textContent = data.schools_summary?.total_schools || 0;
            document.getElementById('total-staff').textContent = data.schools_summary?.avg_staff_per_school ? 
                Math.round((data.schools_summary.avg_staff_per_school * (data.schools_summary.total_schools || 1))) : 0;
            document.getElementById('total-revenue').textContent = 'KES ' + formatNumber(data.revenue || 0);
            document.getElementById('avg-performance').textContent = (data.performance_stats?.avg_overall_score || 0).toFixed(1) + '%';
            document.getElementById('alerts-count').textContent = data.alerts_count || 0;
        }

        // Update charts
        function updateCharts(data) {
            // Schools distribution chart
            const schoolsByTypeCtx = document.getElementById('schoolsByTypeChart');
            if (schoolsByTypeCtx) {
                new Chart(schoolsByTypeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Primary', 'Secondary', 'University', 'Vocational'],
                        datasets: [{
                            data: [15, 20, 7, 3],
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Performance chart
            const performanceCtx = document.getElementById('performanceChart');
            if (performanceCtx) {
                new Chart(performanceCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],
                        datasets: [{
                            label: 'Avg Performance Score',
                            data: [72, 75, 78, 76, 79],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0,123,255,0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }

        // Load schools data
        async function loadSchoolsData() {
            try {
                // Load from data file or API
                const response = await fetch('data/schools.json');
                schoolsData = await response.json();
                renderSchoolsTable(schoolsData);
                document.getElementById('schools-loading').style.display = 'none';
                document.getElementById('schools-table-container').style.display = 'block';
            } catch (error) {
                console.error('Error loading schools:', error);
                showAlert('Error loading schools data', 'danger');
            }
        }

        // Render schools table
        function renderSchoolsTable(schools) {
            const tbody = document.getElementById('schools-table-body');
            tbody.innerHTML = '';

            schools.slice(0, 10).forEach(school => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${school.name || 'N/A'}</strong></td>
                    <td>${school.location || 'N/A'}</td>
                    <td><span class="badge bg-info">${school.type || 'N/A'}</span></td>
                    <td>KES ${formatNumber(school.annualFee || 0)}</td>
                    <td>-</td>
                    <td><span class="badge bg-success">Active</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewSchool()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load fees data
        async function loadFeesData() {
            try {
                const response = await fetch('data/schools.json');
                const schools = await response.json();
                renderFeesTable(schools);
                
                // Calculate affordability stats
                let free = 0, affordable = 0, moderate = 0, expensive = 0;
                schools.forEach(s => {
                    const fee = s.annualFee || 0;
                    if (fee === 0) free++;
                    else if (fee < 50000) affordable++;
                    else if (fee < 150000) moderate++;
                    else expensive++;
                });

                document.getElementById('free-schools-count').textContent = free;
                document.getElementById('affordable-schools-count').textContent = affordable;
                document.getElementById('moderate-schools-count').textContent = moderate;
                document.getElementById('expensive-schools-count').textContent = expensive;
            } catch (error) {
                console.error('Error loading fees:', error);
            }
        }

        // Render fees table
        function renderFeesTable(schools) {
            const tbody = document.getElementById('fees-table-body');
            tbody.innerHTML = '';

            schools.forEach(school => {
                const fee = school.annualFee || 0;
                let affordability = 'Premium';
                let affordabilityColor = 'danger';

                if (fee === 0) {
                    affordability = 'Free';
                    affordabilityColor = 'success';
                } else if (fee < 50000) {
                    affordability = 'Affordable';
                    affordabilityColor = 'success';
                } else if (fee < 150000) {
                    affordability = 'Moderate';
                    affordabilityColor = 'warning';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${school.name}</strong></td>
                    <td>${school.type}</td>
                    <td>KES ${formatNumber(fee)}</td>
                    <td><span class="badge bg-${affordabilityColor}">${affordability}</span></td>
                    <td><span class="badge bg-success">Active</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editFee()">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load payments data
        async function loadPaymentsData() {
            try {
                const response = await fetch('data/payments.json');
                paymentsData = await response.json();
                
                // Calculate payment stats
                let pending = 0, completed = 0, failed = 0, total = 0;
                paymentsData.forEach(p => {
                    const amount = p.amount || 0;
                    total += amount;
                    if (p.status === 'pending') pending++;
                    else if (p.status === 'completed') completed++;
                    else if (p.status === 'failed') failed++;
                });

                document.getElementById('pending-payments').textContent = pending;
                document.getElementById('completed-payments').textContent = completed;
                document.getElementById('failed-payments').textContent = failed;
                document.getElementById('total-collected').textContent = 'KES ' + formatNumber(total);

                renderPaymentsTable(paymentsData);
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        // Render payments table
        function renderPaymentsTable(payments) {
            const tbody = document.getElementById('payments-table-body');
            tbody.innerHTML = '';

            payments.slice(0, 15).forEach(payment => {
                const statusClass = payment.status === 'completed' ? 'success' : 
                                   payment.status === 'pending' ? 'warning' : 'danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${payment.schoolName}</td>
                    <td>KES ${formatNumber(payment.amount)}</td>
                    <td>${new Date(payment.paymentDate).toLocaleDateString()}</td>
                    <td>${payment.purpose || 'Annual Fee'}</td>
                    <td><span class="badge bg-${statusClass}">${payment.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewPayment()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load staff data
        async function loadStaffData() {
            document.getElementById('staff-loading').style.display = 'none';
            document.getElementById('staff-table-container').style.display = 'block';
            showAlert('Staff management interface loaded', 'info');
        }

        // Load performance data
        async function loadPerformanceData() {
            renderPerformanceAlerts([
                { name: 'School A', alert_reason: 'Performance below expected', overall_score: 45, school_id: 1 },
                { name: 'School B', alert_reason: 'Declining trend', overall_score: 62, school_id: 2 }
            ]);
        }

        // Load compliance data
        async function loadComplianceData() {
            document.getElementById('compliant-schools').textContent = '35';
            document.getElementById('at-risk-schools').textContent = '7';
            document.getElementById('non-compliant-schools').textContent = '3';
            showAlert('Compliance data loaded', 'info');
        }

        // Render performance alerts
        function renderPerformanceAlerts(alerts) {
            const container = document.getElementById('performance-alerts');
            container.innerHTML = '';

            if (!alerts || alerts.length === 0) {
                container.innerHTML = '<p class="text-success"><i class="fas fa-check-circle"></i> All schools are performing well</p>';
                return;
            }

            alerts.forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-warning alert-custom mb-3';
                alertDiv.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${alert.name}</strong>
                            <br><small>${alert.alert_reason}</small>
                        </div>
                        <div>
                            <span class="badge bg-danger">${alert.overall_score}%</span>
                        </div>
                    </div>
                `;
                container.appendChild(alertDiv);
            });
        }

        // Utility function to format currency
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Show alert
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-custom alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 320px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 4000);
        }

        // Button handlers
        function refreshDashboard() {
            loadDashboardData();
            showAlert('Dashboard refreshed successfully', 'success');
        }

        function filterSchools() {
            showAlert('Filter applied', 'info');
        }

        function clearFilters() {
            document.getElementById('school-search').value = '';
            document.getElementById('school-type-filter').value = '';
            loadSchoolsData();
            showAlert('Filters cleared', 'info');
        }

        function updateFeeStructure() {
            showAlert('Fee structure updated successfully', 'success');
        }

        function showAddSchoolModal() {
            showAlert('Add School feature coming soon', 'info');
        }

        function showAddStaffModal() {
            showAlert('Add Staff feature coming soon', 'info');
        }

        function calculateAllPerformance() {
            showAlert('Calculating performance for all schools...', 'info');
        }

        function generateReport() {
            showAlert('Report generation started', 'success');
        }

        function setupEventListeners() {
            // Add any additional event listeners here
        }

        function editFee() {
            showAlert('Edit fee feature coming soon', 'info');
        }

        function viewSchool() {
            showAlert('View school details coming soon', 'info');
        }

        function viewPayment() {
            showAlert('View payment details coming soon', 'info');
        }
    </script>

</body>
</html>