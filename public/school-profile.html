<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Profile - KSFP</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .school-name {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .location-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .rating-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .rating-display {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #ecf0f1;
        }

        .star-rating {
            font-size: 3em;
            color: #f39c12;
            margin: 10px 0;
        }

        .overall-score {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .score-label {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .metric-card.security {
            border-left-color: #e74c3c;
        }

        .metric-card.environment {
            border-left-color: #27ae60;
        }

        .metric-card.accessibility {
            border-left-color: #9b59b6;
        }

        .metric-card.teachers {
            border-left-color: #f39c12;
        }

        .metric-title {
            font-size: 0.85em;
            color: #7f8c8d;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }

        .metric-subtext {
            font-size: 0.8em;
            color: #95a5a6;
            margin-top: 5px;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .info-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .info-label {
            font-weight: 600;
            color: #7f8c8d;
        }

        .info-value {
            color: #2c3e50;
            font-size: 1.05em;
        }

        .badge-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .subject-badge {
            background: #ecf0f1;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            color: #2c3e50;
            font-weight: 500;
        }

        .subject-badge.stem {
            background: #e8f5e9;
            color: #27ae60;
            border-left: 3px solid #27ae60;
        }

        .subject-badge.arts {
            background: #f3e5f5;
            color: #8e24aa;
            border-left: 3px solid #8e24aa;
        }

        .subject-badge.science {
            background: #e1f5fe;
            color: #0277bd;
            border-left: 3px solid #0277bd;
        }

        .security-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .security-badge.high {
            background: #d4edda;
            color: #155724;
        }

        .security-badge.medium {
            background: #fff3cd;
            color: #856404;
        }

        .security-badge.low {
            background: #f8d7da;
            color: #721c24;
        }

        .environment-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .environment-badge.calm {
            background: #d4edda;
            color: #155724;
        }

        .environment-badge.moderate {
            background: #fff3cd;
            color: #856404;
        }

        .environment-badge.busy {
            background: #f8d7da;
            color: #721c24;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .recommendation {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #3498db;
        }

        .recommendation.critical {
            background: #fadbd8;
            border-left-color: #e74c3c;
        }

        .recommendation.high {
            background: #fef5e7;
            border-left-color: #f39c12;
        }

        .recommendation-priority {
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .contact-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .contact-item {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .contact-icon {
            font-size: 1.2em;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            margin-top: 40px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .school-name {
                font-size: 1.8em;
            }

            .info-row {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="container">
            <h1 class="school-name" id="schoolName">Loading...</h1>
            <div class="location-badge">
                <i class="fas fa-map-marker-alt"></i>
                <span id="schoolLocation">Location</span>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container">
        <!-- OVERALL RATING -->
        <div class="rating-card">
            <div class="rating-display">
                <div class="overall-score" id="overallScore">0</div>
                <div class="star-rating" id="starRating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <div class="score-label" id="scoreMessage">Excellent school</div>
                <small class="text-muted" id="validUntil">Valid until: --</small>
            </div>

            <div class="metrics-grid">
                <!-- FEE AFFORDABILITY -->
                <div class="metric-card">
                    <div class="metric-title">üìö Fees</div>
                    <div class="metric-value" id="tuitionDisplay">45,000</div>
                    <div class="metric-subtext" id="tuitionStatus">Good affordability</div>
                </div>

                <!-- ENVIRONMENT -->
                <div class="metric-card environment">
                    <div class="metric-title">üåø Environment</div>
                    <div class="metric-value" id="envScore">75</div>
                    <div class="metric-subtext" id="envType">Calm & Peaceful</div>
                </div>

                <!-- SECURITY -->
                <div class="metric-card security">
                    <div class="metric-title">üõ°Ô∏è Security</div>
                    <div class="metric-value" id="secScore">65</div>
                    <div class="metric-subtext" id="secLevel">Medium</div>
                </div>

                <!-- TEACHERS -->
                <div class="metric-card teachers">
                    <div class="metric-title">üë®‚Äçüè´ Teachers</div>
                    <div class="metric-value" id="teacherRatio">1:28</div>
                    <div class="metric-subtext">Student-Teacher Ratio</div>
                </div>

                <!-- DISTANCE -->
                <div class="metric-card accessibility">
                    <div class="metric-title">üìç Distance</div>
                    <div class="metric-value" id="distance">4.2</div>
                    <div class="metric-subtext">km from center</div>
                </div>

                <!-- PROGRAMS -->
                <div class="metric-card">
                    <div class="metric-title">üìñ Programs</div>
                    <div class="metric-value" id="courseCount">12</div>
                    <div class="metric-subtext">Course offerings</div>
                </div>
            </div>
        </div>

        <!-- LOCATION & ACCESSIBILITY -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-map-pin"></i> Location & Accessibility
            </h2>

            <div class="info-row">
                <div class="info-label">County</div>
                <div class="info-value" id="county">--</div>
            </div>

            <div class="info-row">
                <div class="info-label">Zone Type</div>
                <div class="info-value">
                    <span id="zoneType" class="badge bg-primary">--</span>
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">GPS Coordinates</div>
                <div class="info-value" id="gpsCoords">0.0, 0.0</div>
            </div>

            <div class="map-container" id="mapContainer"></div>

            <div class="info-row" style="margin-top: 20px;">
                <div class="info-label">Travel Estimate</div>
                <div class="info-value" id="travelTime">--</div>
            </div>

            <div class="info-row">
                <div class="info-label">Transport Cost</div>
                <div class="info-value" id="transportCost">--</div>
            </div>
        </div>

        <!-- ENVIRONMENT & FACILITIES -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-leaf"></i> Environment & Facilities
            </h2>

            <div class="info-row">
                <div class="info-label">Environment Score</div>
                <div class="info-value">
                    <span id="envScoreDisplay">0</span>/100
                    <span class="environment-badge" id="envBadge">--</span>
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">Description</div>
                <div class="info-value" id="envDescription">--</div>
            </div>

            <div class="info-row">
                <div class="info-label">Compound Size</div>
                <div class="info-value" id="compoundSize">--</div>
            </div>

            <div class="info-row">
                <div class="info-label">Green Space</div>
                <div class="info-value" id="greenSpace">--</div>
            </div>

            <div class="info-row">
                <div class="info-label">Noise Level</div>
                <div class="info-value" id="noiseLevel">--</div>
            </div>
        </div>

        <!-- SECURITY -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-shield-alt"></i> Security
            </h2>

            <div class="info-row">
                <div class="info-label">Security Level</div>
                <div class="info-value">
                    <span class="security-badge" id="secBadge">--</span>
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">Security Score</div>
                <div class="info-value">
                    <span id="secScoreDisplay">0</span>/100
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">Risk Zone</div>
                <div class="info-value" id="riskZone">--</div>
            </div>

            <div class="info-row">
                <div class="info-label">Physical Features</div>
                <div class="info-value">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div>
                            <i class="fas" id="fenceIcon"></i>
                            Fence: <strong id="fenceStatus">--</strong>
                        </div>
                        <div>
                            <i class="fas" id="guardsIcon"></i>
                            Guards: <strong id="guardsStatus">--</strong>
                        </div>
                        <div>
                            <i class="fas" id="cctvIcon"></i>
                            CCTV: <strong id="cctvStatus">--</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TEACHERS & ACADEMICS -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-users"></i> Teachers & Academics
            </h2>

            <div class="info-row">
                <div class="info-label">Total Teachers</div>
                <div class="info-value" id="totalTeachers">0</div>
            </div>

            <div class="info-row">
                <div class="info-label">Qualified Teachers</div>
                <div class="info-value" id="qualifiedTeachers">0 (<span id="qualPercent">0</span>%)</div>
            </div>

            <div class="info-row">
                <div class="info-label">Student-Teacher Ratio</div>
                <div class="info-value" id="ratioDisplay">1:0</div>
            </div>

            <div class="info-row">
                <div class="info-label">Subject Distribution</div>
                <div class="info-value">
                    <div class="badge-group">
                        <span class="subject-badge stem">STEM: <strong id="stemPercent">0</strong>%</span>
                        <span class="subject-badge science">Science: <strong id="sciPercent">0</strong>%</span>
                        <span class="subject-badge arts">Arts: <strong id="artsPercent">0</strong>%</span>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">Teacher Quality Score</div>
                <div class="info-value">
                    <span id="teacherQualityScore">0</span>/100
                </div>
            </div>
        </div>

        <!-- COURSES & PROGRAMS -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-book"></i> Courses & Programs
            </h2>

            <div id="coursesContainer">
                <p class="text-muted">Loading courses...</p>
            </div>
        </div>

        <!-- CONTACT INFORMATION -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-address-card"></i> Contact Information
            </h2>

            <div class="contact-info">
                <div class="contact-item">
                    <span class="contact-icon"><i class="fas fa-phone"></i></span>
                    <div>
                        <strong>Phone:</strong><br>
                        <span id="phone">--</span>
                    </div>
                </div>

                <div class="contact-item">
                    <span class="contact-icon"><i class="fas fa-envelope"></i></span>
                    <div>
                        <strong>Email:</strong><br>
                        <span id="email">--</span>
                    </div>
                </div>

                <div class="contact-item">
                    <span class="contact-icon"><i class="fas fa-globe"></i></span>
                    <div>
                        <strong>Website:</strong><br>
                        <span id="website">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- RECOMMENDATIONS -->
        <div class="section" id="recommendationsSection" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-lightbulb"></i> Areas for Improvement
            </h2>
            <div id="recommendationsContainer"></div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <p>&copy; 2026 Kenya School Fee Platform (KSFP) - Making Education Transparent</p>
        <p><small>All ratings calculated from verified school data and updated annually</small></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>
        // Get school ID from URL
        const params = new URLSearchParams(window.location.search);
        const schoolId = params.get('id');

        // Fetch school profile data
        async function loadSchoolProfile() {
            try {
                const response = await fetch(`/api/schools/${schoolId}/profile`);
                const schoolData = await response.json();

                if (schoolData.success) {
                    displaySchoolProfile(schoolData.data);
                } else {
                    document.body.innerHTML = '<div class="alert alert-danger">School not found</div>';
                }
            } catch (error) {
                console.error('Error loading school:', error);
            }
        }

        function displaySchoolProfile(school) {
            // Header
            document.getElementById('schoolName').textContent = school.name;
            document.getElementById('schoolLocation').textContent = `${school.county} ‚Ä¢ ${school.zone_type}`;

            // Rating
            const rating = school.rating;
            document.getElementById('overallScore').textContent = rating.overall_score;
            document.getElementById('starRating').textContent = getStarVisual(rating.star_rating);
            document.getElementById('scoreMessage').textContent = getRatingMessage(rating.overall_score);
            document.getElementById('validUntil').textContent = `Valid until: ${new Date(rating.valid_until).toLocaleDateString()}`;

            // Metrics
            document.getElementById('tuitionDisplay').textContent = `${school.fees.annual_tuition.toLocaleString()} KES`;
            document.getElementById('envScore').textContent = school.environment_score;
            document.getElementById('envType').textContent = school.environment_type;
            document.getElementById('secScore').textContent = school.security_score;
            document.getElementById('secLevel').textContent = school.security_level;
            document.getElementById('teacherRatio').textContent = `1:${Math.round(school.student_teacher_ratio)}`;
            document.getElementById('distance').textContent = school.distance_km.toFixed(1);
            document.getElementById('courseCount').textContent = school.courses.length;

            // Location
            document.getElementById('county').textContent = school.county;
            document.getElementById('zoneType').textContent = school.zone_type;
            document.getElementById('gpsCoords').textContent = `${school.latitude.toFixed(4)}, ${school.longitude.toFixed(4)}`;
            document.getElementById('travelTime').textContent = school.travel_time.time_display;
            document.getElementById('transportCost').textContent = `${school.transport_cost.monthly_cost} KES/month`;

            // Environment
            document.getElementById('envScoreDisplay').textContent = school.environment_score;
            document.getElementById('envBadge').textContent = school.environment_type;
            document.getElementById('envBadge').className = `environment-badge ${school.environment_type.toLowerCase()}`;
            document.getElementById('envDescription').textContent = school.environment_description;
            document.getElementById('compoundSize').textContent = `${school.compound_size_acres} acres`;
            document.getElementById('greenSpace').textContent = school.has_green_space ? 'Yes' : 'No';
            document.getElementById('noiseLevel').textContent = school.noise_level;

            // Security
            document.getElementById('secBadge').textContent = school.security_level;
            document.getElementById('secBadge').className = `security-badge ${school.security_level.toLowerCase()}`;
            document.getElementById('secScoreDisplay').textContent = school.security_score;
            document.getElementById('riskZone').textContent = school.risk_zone;
            document.getElementById('fenceStatus').textContent = school.has_fence ? '‚úÖ Yes' : '‚ùå No';
            document.getElementById('guardsStatus').textContent = school.has_guards ? '‚úÖ Yes' : '‚ùå No';
            document.getElementById('cctvStatus').textContent = school.has_cctv ? '‚úÖ Yes' : '‚ùå No';

            // Teachers
            document.getElementById('totalTeachers').textContent = school.teacher_stats.total_teachers;
            document.getElementById('qualifiedTeachers').textContent = school.teacher_stats.qualified_teachers;
            document.getElementById('qualPercent').textContent = Math.round((school.teacher_stats.qualified_teachers / school.teacher_stats.total_teachers) * 100);
            document.getElementById('ratioDisplay').textContent = `1:${Math.round(school.student_teacher_ratio)}`;
            document.getElementById('stemPercent').textContent = school.teacher_stats.stem_percentage;
            document.getElementById('sciPercent').textContent = school.teacher_stats.science_percentage;
            document.getElementById('artsPercent').textContent = school.teacher_stats.arts_percentage;
            document.getElementById('teacherQualityScore').textContent = school.teacher_quality_score;

            // Courses
            const coursesHtml = school.courses
                .reduce((html, course) => {
                    const categoryClass = course.category.toLowerCase().replace('_', '-');
                    return html + `
                        <span class="subject-badge ${categoryClass}">${course.course_name}</span>
                    `;
                }, '');
            document.getElementById('coursesContainer').innerHTML = coursesHtml || '<p class="text-muted">No courses listed</p>';

            // Contact
            document.getElementById('phone').textContent = school.phone || 'N/A';
            document.getElementById('email').textContent = school.email || 'N/A';
            document.getElementById('website').textContent = school.website || 'N/A';
        }

        function getStarVisual(stars) {
            let visual = '';
            const full = Math.floor(stars);
            const half = stars % 1 >= 0.5 ? 1 : 0;

            for (let i = 0; i < full; i++) visual += '‚òÖ';
            if (half) visual += '‚≠ê';
            for (let i = 0; i < 5 - full - half; i++) visual += '‚òÜ';

            return visual;
        }

        function getRatingMessage(score) {
            if (score >= 85) return 'Excellent school - Highly recommended';
            if (score >= 70) return 'Good school - Worth considering';
            if (score >= 60) return 'Average school - Mixed reviews';
            if (score >= 40) return 'Below average - Needs improvement';
            return 'Poor school - Significant concerns';
        }

        // Load profile on page load
        loadSchoolProfile();
    </script>
</body>
</html>
